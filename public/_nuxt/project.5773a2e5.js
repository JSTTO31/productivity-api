import{b6 as E,r as f,aD as I,F as N,c as F,aP as g,G as q,aw as z,b7 as i}from"./entry.76ac6703.js";function B(r){return{...r,sections:[...r.sections.map(n=>({...n,tasks:[...n.tasks.map(d=>({...d}))]}))]}}const J={project:B},G=E("project",()=>{var m;const r=f([]),n=f(null),{user:d}=I(N()),_=F(()=>{var e;return n.value?(e=n.value.members.find(a=>{var t;return a.user._id==((t=d.value)==null?void 0:t._id)}))==null?void 0:e.role:null}),{project:p}=J,c=g(),h=f(null),v=q({search:"",priority:["low","medium","high"],watch:["watching","unwatching"],complete:["completed","incomplete"],sections:((m=n.value)==null?void 0:m.sections.map(e=>e._id||e.tempId))||[]});z(()=>{var e;return((e=n.value)==null?void 0:e._id)||null},e=>{var a;v.sections=((a=n.value)==null?void 0:a.sections.map(t=>t._id||t.tempId))||[]});async function w(){return await i("/projects",{onResponse:e=>{r.value=e.response._data.projects}})}async function j(){return await i("/projects",{method:"POST",body:{title:"New Project"},onResponse(e){e.response.status==200&&(r.value.unshift(e.response._data.project),c.addSnackbar("Project successfully added!"))}})}async function b(e){return await i("/projects/"+e,{onResponse(a){a.response.status==200&&a.response._data.project&&(n.value=a.response._data.project)}})}async function R(){const e=r.value.find(o=>{var s;return o._id==((s=n.value)==null?void 0:s._id)}),a=p(e),t=p(n.value);if(!(!a._id||!(t!=null&&t._id)||JSON.stringify(a)==JSON.stringify(t)))return await i("/projects/"+t._id,{method:"PUT",body:{...n.value},onResponseError(o){const s=g();if(o.response.status==401){const u="Unauthorize Action",l="You are not authorized to perform this action. Please contact your administrator for assistance.";s.add(u,l,"error")}else{const u="Request Error",l="Oops! Something went wrong with your request. Please try again later.";s.add(u,l,"error")}r.value=r.value.map(u=>u._id==a._id?a:u),n.value=p(a)},onResponse(o){if(o.response.status!=200)return;const s=o.response._data.project;r.value=r.value.map(u=>u._id==s._id?s:u)}})}async function S(e,a){var o;if(((o=n.value)==null?void 0:o._id)==e){n.value.title=a.title;return}const t=r.value.find(s=>s._id==e);if(t)return t.title=a.title,await i("/projects/"+e,{body:{...t},method:"PUT",onResponse(s){var l;if(s.response.status==401)return;const u=s.response._data.project;r.value=r.value.map(y=>y._id==e?u:y),((l=n.value)==null?void 0:l._id)==e&&(n.value=u)}})}async function P(e){return await i("/projects/"+e,{method:"DELETE",onResponse(a){var t;a.response.status==200&&(r.value=r.value.filter(o=>o._id!=e),c.addSnackbar("Project successfully removed!"),((t=n.value)==null?void 0:t._id)==e&&(n.value=null))}})}async function $(e){return await i("/projects/"+e+"/leave",{method:"delete",onResponse(a){var t;a.response.status==200&&(r.value=r.value.filter(o=>o._id!=e),((t=n.value)==null?void 0:t._id)==e&&(n.value=null),c.addSnackbar("Project leave successfully"))}})}async function T(e,a){return await i(`/projects/${e}/members`,{method:"POST",body:{members:a},onResponse(t){var s;if(t.response.status!=200)return;const o=t.response._data.project;o&&(r.value=r.value.map(u=>u._id==o._id?o:u),((s=n.value)==null?void 0:s._id)==o._id&&(n.value=o),a.length>1?c.addSnackbar("Members Added Successfully"):c.addSnackbar("Member Added Successfully"))}})}async function M(e,a){return await i(`/projects/${e}/members/edit/roles`,{method:"PUT",body:{members:a},onResponse(t){if(t.response.status!=200)return;const o=t.response._data.project;r.value=r.value.map(s=>s._id==o._id?o:s),n.value&&o._id==n.value._id&&(n.value=o),c.addSnackbar("Member succesfully update!")}})}async function k(e,a){return await i(`/projects/${e}/find/members?email=`+a,{})}async function O(e,a){return await i(`/projects/${e}/messages`,{method:"POST",body:{text:a},onResponse(t){var s;if(t.response.status==401||t.response.status==500)return;const o=t.response._data.message;r.value=r.value.map(u=>u._id==e?{...u,messages:[...u.messages,o]}:u),e==((s=n.value)==null?void 0:s._id)&&n.value.messages.push(o)}})}async function U(e,a){return await i(`/projects/${e}/messages/${a}/remove`,{method:"PUT",onResponse(t){var o;t.response.status==401||t.response.status==500||(r.value=r.value.map(s=>s._id==e?{...s,messages:s.messages.filter(u=>u._id!=a)}:s),e==((o=n.value)==null?void 0:o._id)&&(n.value.messages=n.value.messages.filter(s=>s._id!=a)))}})}async function D(e,a){return await i(`/projects/${e}/messages/${a}/unsent`,{method:"PUT",onResponse(t){var o;t.response.status==401||t.response.status==500||(r.value=r.value.map(s=>s._id==e?{...s,messages:s.messages.map(u=>u._id==a?{...u,unsent:!0}:u)}:s),e==((o=n.value)==null?void 0:o._id)&&(n.value.messages=n.value.messages.map(s=>s._id==a?{...s,unsent:!0}:s)))}})}async function A(e){return await i(`/projects/${e}/messages`,{onResponse(a){var o;if(a.response.status==401)return;const t=a.response._data.messages;r.value=r.value.map(s=>s._id==e?{...s,messages:t}:s),e==((o=n.value)==null?void 0:o._id)&&(n.value.messages=t)}})}return{projects:r,project:n,role:_,sectionFilter:v,sectionSort:h,getAll:w,store:j,findById:b,update:R,addMembers:T,findMembers:k,updateRoles:M,remove:P,leave:$,sendMessage:O,getMessages:A,removeMessage:U,unsentMessage:D,updateById:S}});export{G as u};
